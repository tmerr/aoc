# Day 17

Day 17: Finally a non-graph problem! This one has to do with implementing a simple VM.

## Part1

Part 1 asks to simulate the VM's execution, given the initial register states and program.

This was a direct translation of the problem statement to code.

## Part 2

Part 2 asks to find an initial register state, that makes the output the same as the program. (For what initial state is this program a quine?).

For this part I got lucky that I wrote part 1 using integer constraints (CLPFD). I set up an equation for the solution where the A register was a free variable. CLPFD found a formula for many solutions. Then I trial-and-errored a few search ("labeling" in CLPFD jargon) strategies and with `bisect` it was magically able to find the minimum in under a second. The answer was in the 100s of trillions.

After CLPFD found one solution, Prolog backtracked, and I hit `ctrl+C`. I haven't investigated yet why Prolog is looking for alternative formulas and whether it is important for finding the minimum.

Since I think it's interesting how terrible it looks, so the CLPFD formula for the solutions:

```
InitialRegA in 0..281474976710655,
InitialRegA div 8#=_A,
InitialRegA>>_B#=_C,
InitialRegA mod 8#=_D,
_D in 0..7,
_B#=_D xor 1,
_E#=_B xor 5,
_F#=_E xor _C,
_F mod 8#=2,
_A in 0..35184372088831,
_A div 8#=_G,
_A>>_H#=_I,
_A mod 8#=_J,
dif(_A, 0),
_J in 0..7,
_H#=_J xor 1,
_K#=_H xor 5,
_L#=_K xor _I,
_L mod 8#=4,
_G in 0..4398046511103,
_G div 8#=_M,
_G>>_N#=_O,
_G mod 8#=_P,
dif(_G, 0),
_P in 0..7,
_N#=_P xor 1,
_Q#=_N xor 5,
_R#=_Q xor _O,
_R mod 8#=1,
_M in 0..549755813887,
_M div 8#=_S,
_M>>_T#=_U,
_M mod 8#=_V,
dif(_M, 0),
_V in 0..7,
_T#=_V xor 1,
_W#=_T xor 5,
_X#=_W xor _U,
_X mod 8#=1,
_S in 0..68719476735,
_S div 8#=_Y,
_S>>_Z#=_A1,
_S mod 8#=_B1,
dif(_S, 0),
_B1 in 0..7,
_Z#=_B1 xor 1,
_C1#=_Z xor 5,
_D1#=_C1 xor _A1,
_D1 mod 8#=7,
_Y in 0..8589934591,
_Y div 8#=_E1,
_Y>>_F1#=_G1,
_Y mod 8#=_H1,
dif(_Y, 0),
_H1 in 0..7,
_F1#=_H1 xor 1,
_I1#=_F1 xor 5,
_J1#=_I1 xor _G1,
_J1 mod 8#=5,
_E1 in 0..1073741823,
_E1 div 8#=_K1,
_E1>>_L1#=_M1,
_E1 mod 8#=_N1,
dif(_E1, 0),
_N1 in 0..7,
_L1#=_N1 xor 1,
_O1#=_L1 xor 5,
_P1#=_O1 xor _M1,
_P1 mod 8#=1,
_K1 in 0..134217727,
_K1 div 8#=_Q1,
_K1>>_R1#=_S1,
_K1 mod 8#=_T1,
dif(_K1, 0),
_T1 in 0..7,
_R1#=_T1 xor 1,
_U1#=_R1 xor 5,
_V1#=_U1 xor _S1,
_V1 mod 8#=5,
_Q1 in 0..16777215,
_Q1 div 8#=_W1,
_Q1>>_X1#=_Y1,
_Q1 mod 8#=_Z1,
dif(_Q1, 0),
_Z1 in 0..7,
_X1#=_Z1 xor 1,
_A2#=_X1 xor 5,
_B2#=_A2 xor _Y1,
_B2 mod 8#=4,
_W1 in 0..2097151,
_W1 div 8#=_C2,
_W1>>_D2#=_E2,
_W1 mod 8#=_F2,
dif(_W1, 0),
_F2 in 0..7,
_D2#=_F2 xor 1,
_G2#=_D2 xor 5,
_H2#=_G2 xor _E2,
_H2 mod 8#=1,
_C2 in 0..262143,
_C2 div 8#=_I2,
_C2>>_J2#=_K2,
_C2 mod 8#=_L2,
dif(_C2, 0),
_L2 in 0..7,
_J2#=_L2 xor 1,
_M2#=_J2 xor 5,
_N2#=_M2 xor _K2,
_N2 mod 8#=5,
_I2 in 0..32767,
_I2 div 8#=_O2,
_I2>>_P2#=_Q2,
_I2 mod 8#=_R2,
dif(_I2, 0),
_R2 in 0..7,
_P2#=_R2 xor 1,
_S2#=_P2 xor 5,
_T2#=_S2 xor _Q2,
_T2 mod 8#=5,
_O2 in 0..4095,
_O2 div 8#=_U2,
_O2>>_V2#=_W2,
_O2 mod 8#=_X2,
dif(_O2, 0),
_X2 in 0..7,
_V2#=_X2 xor 1,
_Y2#=_V2 xor 5,
_Z2#=_Y2 xor _W2,
_Z2 mod 8#=0,
_U2 in 0..511,
_U2 div 8#=_A3,
_U2>>_B3#=_C3,
_U2 mod 8#=_D3,
dif(_U2, 0),
_D3 in 0..7,
_B3#=_D3 xor 1,
_E3#=_B3 xor 5,
_F3#=_E3 xor _C3,
_F3 mod 8#=3,
_A3 in 0..63,
_A3 div 8#=_G3,
_A3>>_H3#=_I3,
_A3 mod 8#=_J3,
dif(_A3, 0),
_J3 in 0..7,
_H3#=_J3 xor 1,
_K3#=_H3 xor 5,
_L3#=_K3 xor _I3,
_L3 mod 8#=3,
_G3 in 0..7,
_M3#=_G3 xor 1,
_G3>>_M3#=_N3,
dif(_G3, 0),
_O3#=_M3 xor 5,
_P3#=_O3 xor _N3,
_P3 mod 8#=0
```